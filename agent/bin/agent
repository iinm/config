#!/usr/bin/env bash

set -eu -o pipefail

this_dir="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
agent_root="$(cd "$this_dir/.." && pwd)"

# Install dependencies
if ! test -d "$agent_root/node_modules"; then
  (cd "$agent_root"; npm install --silent)
fi

# Run the agent
export NODE_OPTIONS="--disable-warning=DEP0040"
"$agent_root/env.sh" node "$agent_root/node_modules/.bin/tsx" "$agent_root/index.ts" "$@"
